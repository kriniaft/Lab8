DROP TABLE IF EXISTS person CASCADE;
DROP TABLE IF EXISTS users CASCADE;
DROP TYPE  IF EXISTS color;
DROP TYPE  IF EXISTS country;
DROP SEQUENCE IF EXISTS users_id_seq;
DROP SEQUENCE IF EXISTS person_id_seq;

CREATE TYPE color AS ENUM (
    'GREEN'
    'RED'
    'BLUE'
    'YELLOW'
    'WHITE'
);

CREATE TYPE country  AS ENUM
(
    'USA'
    'GERMANY'
    'SPAIN'
    'CHINA'

);

CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    login TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT now()
);

CREATE TABLE person (
    id            BIGSERIAL PRIMARY KEY,
    name          TEXT        NOT NULL CHECK ( name <> '' ),
    coord_x       FLOAT       NOT NULL CHECK ( coord_x < 946 ),
    coord_y       FLOAT       NOT NULL,
    creation_date TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    height        FLOAT       NOT NULL CHECK ( height > 0 AND height < 4 ),
    passport_id   TEXT UNIQUE CHECK ( passport_id ~ '^\d{1,9}$' ),
    hair_color    TEXT        NOT NULL CHECK ( hair_color IN ('GREEN', 'RED', 'BLUE', 'YELLOW', 'WHITE')),
    nationality   TEXT        NOT NULL CHECK ( nationality IN ('USA', 'GERMANY', 'SPAIN', 'CHINA')),
    locat_x       FLOAT       NOT NULL,
    locat_y       FLOAT,
    locat_z       FLOAT       NOT NULL
    username      TEXT        NOT NULL

);

SELECT name,
       nationality,
       creation_date AT TIME ZONE
       CASE nationality
           WHEN 'USA' THEN 'America/New_York'
           WHEN 'GERMANY' THEN 'Europe/Berlin'
           WHEN 'SPAIN' THEN 'Europe/Madrid'
           WHEN 'CHINA' THEN 'Asia/Shanghai'
           END AS local_time
FROM Person;
